/* This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at http://mozilla.org/MPL/2.0/. */

'use strict';
module.exports = function () {
  // The array is converted into a RegExp
  const FRONTEND_ROUTES = [
    'account_recovery_confirm_key',
    'account_recovery_reset_password',
    'authorization',
    'cannot_create_account',
    'choose_what_to_sync',
    'clear',
    'complete_reset_password',
    'complete_signin',
    'confirm',
    'confirm_reset_password',
    'confirm_signin',
    'confirm_signup_code',
    'connect_another_device',
    'connect_another_device/why',
    'cookies_disabled',
    'force_auth',
    'get_flow',
    'inline_totp_setup',
    'inline_recovery_setup',
    'legal',
    'oauth',
    'oauth/force_auth',
    'oauth/signin',
    'oauth/signup',
    'pair',
    'pair/failure',
    'pair/success',
    'pair/supp',
    'pair/unsupported',
    'post_verify/account_recovery/add_recovery_key',
    'post_verify/account_recovery/confirm_password',
    'post_verify/account_recovery/confirm_recovery_key',
    'post_verify/account_recovery/save_recovery_key',
    'post_verify/account_recovery/verified_recovery_key',
    'post_verify/cad_qr/get_started',
    'post_verify/cad_qr/ready_to_scan',
    'post_verify/cad_qr/scan_code',
    'post_verify/cad_qr/connected',
    'post_verify/newsletters/add_newsletters',
    'post_verify/password/force_password_change',
    'post_verify/secondary_email/add_secondary_email',
    'post_verify/secondary_email/confirm_secondary_email',
    'post_verify/secondary_email/verified_secondary_email',
    'primary_email_verified',
    'report_signin',
    'reset_password',
    'reset_password_confirmed',
    'reset_password_verified',
    'reset_password_with_recovery_key_verified',
    'security_events',
    'settings',
    'settings/account_recovery',
    'settings/account_recovery/confirm_password',
    'settings/account_recovery/confirm_revoke',
    'settings/account_recovery/recovery_key',
    'settings/avatar/camera',
    'settings/avatar/change',
    'settings/avatar/crop',
    'settings/change_password',
    'settings/clients',
    'settings/clients/disconnect',
    'settings/communication_preferences',
    'settings/delete_account',
    'settings/display_name',
    'settings/emails',
    'settings/two_step_authentication',
    'settings/two_step_authentication/recovery_codes',
    'settings/two_step_authentication/secret',
    'signin',
    'signin_bounced',
    'signin_token_code',
    'signin_totp_code',
    'signin_recovery_code',
    'signin_confirmed',
    'signin_permissions',
    'signin_reported',
    'signin_unblock',
    'signin_verified',
    'signup',
    'signup_confirmed',
    'signup_permissions',
    'signup_verified',
    'secondary_email_verified',
    'sms',
    'sms/sent',
    'sms/sent/why',
    'sms/why',
    'subscriptions',
    'subscriptions/products/[\\w_]+',
    'support',
    'verify_email',
    'verify_primary_email',
    'verify_secondary_email',
    'would_you_like_to_sync',
  ].join('|'); // prepare for use in a RegExp

  return {
    method: 'get',
    path: new RegExp('^/(' + FRONTEND_ROUTES + ')/?$'),
    process: function (req, res, next) {
      // setting the url to / will use the correct
      // index.html for either dev or prod mode.
      req.url = '/';
      next();
    },
  };
};
